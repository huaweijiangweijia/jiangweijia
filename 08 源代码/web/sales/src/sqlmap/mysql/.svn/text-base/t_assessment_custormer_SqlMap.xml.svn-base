<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd">
<sqlMap namespace="t_assessment_custormer">
  <resultMap class="com.tl.resource.dao.pojo.TCustormerAssessment" id="ibatorgenerated_BaseResultMap">
    <!--
      WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
      This element was generated on Wed Oct 14 14:13:27 CST 2009.
    -->
    <result column="id" jdbcType="VARCHAR" property="id" />
    <result column="customer_code" jdbcType="VARCHAR" property="custormerCode" />
    <result column="emp_number" jdbcType="INTEGER" property="empNumber" />
    <result column="annual_sale" jdbcType="DECIMAL" property="annualSale" />
    <result column="product" jdbcType="VARCHAR" property="product" />
    <result column="competitive" jdbcType="DECIMAL" property="competitive" />
    <result column="sales_proportion" jdbcType="VARCHAR" property="salesProportion" />
    <result column="growth" jdbcType="DECIMAL" property="growth" />
    <result column="gross_margin" jdbcType="VARCHAR" property="grossMargin" />
    <result column="pay_risk" jdbcType="VARCHAR" property="payRisk" />
    <result column="pay_punctualityrate" jdbcType="VARCHAR" property="payPunctualityRate" />
    <result column="pay_delay" jdbcType="INTEGER" property="payDelay" />
    <result column="willingness" jdbcType="VARCHAR" property="willingness" />
    <result column="score" jdbcType="DECIMAL" property="score" />
    <result column="create_time" jdbcType="TIMESTAMP" property="createTime" />
    <result column="create_user_id" jdbcType="VARCHAR" property="createUserId" />
    <result column="last_edit_time" jdbcType="TIMESTAMP" property="lastEditTime" />
    <result column="last_user_id" jdbcType="VARCHAR" property="lastUserId" />
    <result column="create_user_name" jdbcType="VARCHAR" property="createUserName" />
  	<result column="last_user_name" jdbcType="VARCHAR" property="lastUserName" />
  </resultMap>
  <resultMap class="com.tl.resource.business.dto.CustormerAssessmentDto" id="assessmentALl" extends="ibatorgenerated_BaseResultMap">
  	<result column="cooperation_amount" jdbcType="DECIMAL" property="cooperationAmount" />
  	<result column="customer_name" jdbcType="VARCHAR" property="custormerName" />
  </resultMap>
  <select id="getAssessmentList" parameterClass="java.util.Map" resultMap="assessmentALl">
	
	SELECT ac.*,t.* FROM t_assessment_customer ac
	LEFT JOIN (
		SELECT customer_code,customer_name,SUM(final_money) AS cooperation_amount FROM t_contract_infor WHERE STATUS IN(4,5) GROUP BY customer_code
	) t ON ac.customer_code = t.customer_code
		
   	<dynamic prepend="where">
	   <isNotEmpty prepend="and" property="custormerCode">
			ac.customer_code = '$custormerCode$'
		</isNotEmpty>
   	 </dynamic>
		
      <isNotEmpty property="sort" >
        <![CDATA[
          order by $sort$ $dir$
        ]]>
      </isNotEmpty>
    <![CDATA[
        limit #start#, #limit# 
    ]]>
  </select>
  <select id="getAssessmentListCount" parameterClass="java.util.Map" resultClass="java.lang.Integer">
   	 select count(*) from t_assessment_customer t
   	<dynamic prepend="where">
	   <isNotEmpty prepend="and" property="custormerCode">
			t.customer_code = '$custormer_code$'
		</isNotEmpty>
   	 </dynamic>
  </select>
  
  
  
  
  <delete id="deleteByPrimaryKey" parameterClass="com.tl.resource.dao.pojo.TCustormerAssessment">
    delete from t_assessment_customer
    where id = #id:VARCHAR#
  </delete>
  
  
 <insert id="insert" parameterClass="com.tl.resource.dao.pojo.TCustormerAssessment">
    INSERT INTO t_assessment_customer (id, customer_code, emp_number, annual_sale, product, 
    competitive, sales_proportion, growth, gross_margin, pay_risk, pay_punctualityrate, pay_delay, willingness, 
    score, create_time, create_user_id, create_user_name, last_edit_time, last_user_id, last_user_name)
    values (#id:VARCHAR#, #custormerCode:VARCHAR#, #empNumber:INTEGER#, #annualSale:DECIMAL#,#product:VARCHAR#,
      #competitive:VARCHAR#, #salesProportion:DECIMAL#, #growth:DECIMAL#,
      #grossMargin:VARCHAR#,
      #payRisk:VARCHAR#, #payPunctualityRate:VARCHAR#, #payDelay:INTEGER#,
      #willingness:VARCHAR#, #score:DECIMAL#,#createTime:TIMESTAMP#, #createUserId:VARCHAR#,#createUserName:VARCHAR#, #lastEditTime:TIMESTAMP#,
      #lastUserId:VARCHAR#,#lastUserName:VARCHAR#)
  </insert>
  <update id="updateByPrimaryKey" parameterClass="com.tl.resource.dao.pojo.TCustormerAssessment">
    update t_assessment_customer
    set customer_code = #custormerCode:VARCHAR#,
      emp_number = #empNumber:INTEGER#,
      annual_sale = #annualSale:DECIMAL#,
      product = #product:VARCHAR#,
      competitive = #competitive:VARCHAR#,
      sales_proportion = #salesProportion:VARCHAR#,
      growth = #growth:DECIMAL#,
      gross_margin = #grossMargin:DECIMAL#,
      pay_risk = #payRisk:DECIMAL#,
      pay_punctualityrate = #payPunctualityRate:VARCHAR#,
      pay_delay = #payDelay:VARCHAR#,
      willingness = #willingness:VARCHAR#,
      score = #score:INTEGER#,
      last_edit_time = #lastEditTime:TIMESTIMP#,
      last_user_name = #lastUserName:VARCHAR#,
      last_user_id = #lastUserId:VARCHAR#
    where id = #id:VARCHAR#
  </update>
  
   
</sqlMap>