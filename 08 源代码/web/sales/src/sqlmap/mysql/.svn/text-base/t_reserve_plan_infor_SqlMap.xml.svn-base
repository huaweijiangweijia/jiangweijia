<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd" >
<sqlMap namespace="t_reserve_plan_infor" >
<typeAlias alias="reservePlanDetailDto" type="com.tl.resource.business.dto.ReservePlanDetailDto"/>

  <resultMap id="ibatorgenerated_BaseResultMap" class="com.tl.resource.dao.pojo.TReservePlanInfor" >
    <result column="id" property="id" jdbcType="VARCHAR" />
    <result column="stock_order_detail_id" property="stockOrderDetailId" jdbcType="VARCHAR" />
    <result column="brand_code" property="brandCode" jdbcType="VARCHAR" />
    <result column="product_code" property="productCode" jdbcType="VARCHAR" />
    <result column="tools_id" property="toolsId" jdbcType="VARCHAR" />
    <result column="parent_tools_id" property="parentToolsId" jdbcType="VARCHAR" />
    <result column="leaf" property="leaf" jdbcType="INTEGER" />
    <result column="product_name" property="productName" jdbcType="VARCHAR" />
    <result column="plan_amount" property="planAmount" jdbcType="DECIMAL" />
    <result column="product_unit" property="productUnit" jdbcType="VARCHAR" />
    <result column="price" property="price" jdbcType="DECIMAL" />
    <result column="product_money" property="productMoney" jdbcType="DECIMAL" />
    <result column="order_infor_id" property="orderInforId" jdbcType="VARCHAR" />
    <result column="order_code" property="orderCode" jdbcType="VARCHAR" />
    <result column="contract_id" property="contractId" jdbcType="VARCHAR" />
    <result column="contract_code" property="contractCode" jdbcType="VARCHAR" />
    <result column="status" property="status" jdbcType="INTEGER" />
    <result column="plan_code" property="planCode" jdbcType="VARCHAR" />
    <result column="edit_date" property="editDate" jdbcType="TIMESTAMP" />
    <result column="user_id" property="userId" jdbcType="VARCHAR" />
    <result column="user_name" property="userName" jdbcType="VARCHAR" />
    <result column="product_brand" property="productBrand" jdbcType="VARCHAR" />
    <result column="mat_stock_order_detail_id" property="matStockOrderDetailId" jdbcType="VARCHAR"/>
  </resultMap>
  
  <resultMap id="resultHasReserve" class="reservePlanDetailDto" extends="ibatorgenerated_BaseResultMap">
    <result property="children" column="stock_order_detail_id" select="t_reserve_plan_infor.getReservePlanDetailChildren"/>
    <result property="reserveAmount" column="reserve_amount" jdbcType="DECIMAL"/>
    <result property="orderAmount" column="order_amount" jdbcType="DECIMAL"/>
    <result property="serialNumber" column="serial_number" jdbcType="DECIMAL"/>
    <result property="projectCode" column="project_code" jdbcType="VARCHAR"/>
  </resultMap>
  
   <resultMap id="resultHasReservePlan" class="reservePlanDetailDto" extends="ibatorgenerated_BaseResultMap">
    <result property="children" column="stock_order_detail_id" select="t_reserve_plan_infor.getReservePlanDetailChildren"/>
  </resultMap>
  
   <resultMap id="resultMap" class="reservePlanDetailDto" extends="ibatorgenerated_BaseResultMap">
  </resultMap>
  
  <sql id="ibatorgenerated_Example_Where_Clause" >
    <!--
      WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
      This element was generated on Mon Nov 23 20:26:45 CST 2009.
    -->
    <iterate property="oredCriteria" conjunction="or" prepend="where" removeFirstPrepend="iterate" >
      <isEqual property="oredCriteria[].valid" compareValue="true" >
        (
        <iterate prepend="and" property="oredCriteria[].criteriaWithoutValue" conjunction="and" >
          $oredCriteria[].criteriaWithoutValue[]$
        </iterate>
        <iterate prepend="and" property="oredCriteria[].criteriaWithSingleValue" conjunction="and" >
          $oredCriteria[].criteriaWithSingleValue[].condition$
            #oredCriteria[].criteriaWithSingleValue[].value#
        </iterate>
        <iterate prepend="and" property="oredCriteria[].criteriaWithListValue" conjunction="and" >
          $oredCriteria[].criteriaWithListValue[].condition$
          <iterate property="oredCriteria[].criteriaWithListValue[].values" open="(" close=")" conjunction="," >
            #oredCriteria[].criteriaWithListValue[].values[]#
          </iterate>
        </iterate>
        <iterate prepend="and" property="oredCriteria[].criteriaWithBetweenValue" conjunction="and" >
          $oredCriteria[].criteriaWithBetweenValue[].condition$
          #oredCriteria[].criteriaWithBetweenValue[].values[0]# and
          #oredCriteria[].criteriaWithBetweenValue[].values[1]#
        </iterate>
        )
      </isEqual>
    </iterate>
  </sql>
  <select id="ibatorgenerated_selectByExample" resultMap="ibatorgenerated_BaseResultMap" parameterClass="com.tl.resource.dao.pojo.TReservePlanInforExample" >
    <!--
      WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
      This element was generated on Mon Nov 23 20:26:45 CST 2009.
    -->
    select id, stock_order_detail_id, brand_code, product_code, tools_id, parent_tools_id, leaf,
      product_name, plan_amount, product_unit, price, product_money, order_infor_id, order_code,
      contract_id, contract_code, status, plan_code, edit_date, user_id, user_name,product_brand,mat_stock_order_detail_id
    from t_reserve_plan_infor
    <isParameterPresent >
      <include refid="t_reserve_plan_infor.ibatorgenerated_Example_Where_Clause" />
      <isNotEmpty property="startIndex" >
	        limit $startIndex$,$pageSize$
	   </isNotEmpty>
      <isNotNull property="orderByClause" >
        order by $orderByClause$
      </isNotNull>
    </isParameterPresent>
  </select>
  <select id="ibatorgenerated_selectByPrimaryKey" resultMap="ibatorgenerated_BaseResultMap" parameterClass="com.tl.resource.dao.pojo.TReservePlanInfor" >
    <!--
      WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
      This element was generated on Mon Nov 23 20:26:45 CST 2009.
    -->
    select id, stock_order_detail_id, brand_code, product_code, tools_id, parent_tools_id, leaf,
      product_name, plan_amount, product_unit, price, product_money, order_infor_id, order_code,
      contract_id, contract_code, status, plan_code, edit_date, user_id, user_name,product_brand,mat_stock_order_detail_id
    from t_reserve_plan_infor
    where id = #id:VARCHAR#
  </select>
  <delete id="ibatorgenerated_deleteByPrimaryKey" parameterClass="com.tl.resource.dao.pojo.TReservePlanInfor" >
    <!--
      WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
      This element was generated on Mon Nov 23 20:26:45 CST 2009.
    -->
    delete from t_reserve_plan_infor
    where id = #id:VARCHAR#
  </delete>
  <delete id="ibatorgenerated_deleteByExample" parameterClass="com.tl.resource.dao.pojo.TReservePlanInforExample" >
    <!--
      WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
      This element was generated on Mon Nov 23 20:26:45 CST 2009.
    -->
    delete from t_reserve_plan_infor
    <include refid="t_reserve_plan_infor.ibatorgenerated_Example_Where_Clause" />
  </delete>
  <insert id="ibatorgenerated_insert" parameterClass="com.tl.resource.dao.pojo.TReservePlanInfor" >
    <!--
      WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
      This element was generated on Mon Nov 23 20:26:45 CST 2009.
    -->
    insert into t_reserve_plan_infor (id, stock_order_detail_id, brand_code, product_code, tools_id,
      parent_tools_id, leaf, product_name, plan_amount, product_unit, price, product_money,
      order_infor_id, order_code, contract_id, contract_code, status, plan_code, edit_date, user_id,
      user_name,product_brand,mat_stock_order_detail_id)
    values (#id:VARCHAR#, #stockOrderDetailId:VARCHAR#, #brandCode:VARCHAR#, #productCode:VARCHAR#,
      #toolsId:VARCHAR#, #parentToolsId:VARCHAR#, #leaf:INTEGER#, #productName:VARCHAR#,
      #planAmount:DECIMAL#, #productUnit:VARCHAR#, #price:DECIMAL#, #productMoney:DECIMAL#,
      #orderInforId:VARCHAR#, #orderCode:VARCHAR#, #contractId:VARCHAR#, #contractCode:VARCHAR#,
      #status:INTEGER#, #planCode:VARCHAR#, #editDate:TIMESTAMP#, #userId:VARCHAR#,
      #userName:VARCHAR#,#productBrand:VARCHAR#,#matStockOrderDetailId:VARCHAR#)
  </insert>
  <insert id="ibatorgenerated_insertSelective" parameterClass="com.tl.resource.dao.pojo.TReservePlanInfor" >
    <!--
      WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
      This element was generated on Mon Nov 23 20:26:45 CST 2009.
    -->
    insert into t_reserve_plan_infor
    <dynamic prepend="(" >
      <isNotNull prepend="," property="id" >
        id
      </isNotNull>
      <isNotNull prepend="," property="stockOrderDetailId" >
        stock_order_detail_id
      </isNotNull>
      <isNotNull prepend="," property="brandCode" >
        brand_code
      </isNotNull>
      <isNotNull prepend="," property="productCode" >
        product_code
      </isNotNull>
      <isNotNull prepend="," property="toolsId" >
        tools_id
      </isNotNull>
      <isNotNull prepend="," property="parentToolsId" >
        parent_tools_id
      </isNotNull>
      <isNotNull prepend="," property="leaf" >
        leaf
      </isNotNull>
      <isNotNull prepend="," property="productName" >
        product_name
      </isNotNull>
      <isNotNull prepend="," property="planAmount" >
        plan_amount
      </isNotNull>
      <isNotNull prepend="," property="productUnit" >
        product_unit
      </isNotNull>
      <isNotNull prepend="," property="price" >
        price
      </isNotNull>
      <isNotNull prepend="," property="productMoney" >
        product_money
      </isNotNull>
      <isNotNull prepend="," property="orderInforId" >
        order_infor_id
      </isNotNull>
      <isNotNull prepend="," property="orderCode" >
        order_code
      </isNotNull>
      <isNotNull prepend="," property="contractId" >
        contract_id
      </isNotNull>
      <isNotNull prepend="," property="contractCode" >
        contract_code
      </isNotNull>
      <isNotNull prepend="," property="status" >
        status
      </isNotNull>
      <isNotNull prepend="," property="planCode" >
        plan_code
      </isNotNull>
      <isNotNull prepend="," property="editDate" >
        edit_date
      </isNotNull>
      <isNotNull prepend="," property="userId" >
        user_id
      </isNotNull>
      <isNotNull prepend="," property="userName" >
        user_name
      </isNotNull>
      <isNotNull prepend="," property="productBrand" >
        product_brand
      </isNotNull>
      <isNotNull prepend="," property="matStockOrderDetailId" >
        mat_stock_order_detail_id
      </isNotNull>
      )
    </dynamic>
    values
    <dynamic prepend="(" >
      <isNotNull prepend="," property="id" >
        #id:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="stockOrderDetailId" >
        #stockOrderDetailId:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="brandCode" >
        #brandCode:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="productCode" >
        #productCode:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="toolsId" >
        #toolsId:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="parentToolsId" >
        #parentToolsId:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="leaf" >
        #leaf:INTEGER#
      </isNotNull>
      <isNotNull prepend="," property="productName" >
        #productName:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="planAmount" >
        #planAmount:DECIMAL#
      </isNotNull>
      <isNotNull prepend="," property="productUnit" >
        #productUnit:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="price" >
        #price:DECIMAL#
      </isNotNull>
      <isNotNull prepend="," property="productMoney" >
        #productMoney:DECIMAL#
      </isNotNull>
      <isNotNull prepend="," property="orderInforId" >
        #orderInforId:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="orderCode" >
        #orderCode:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="contractId" >
        #contractId:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="contractCode" >
        #contractCode:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="status" >
        #status:INTEGER#
      </isNotNull>
      <isNotNull prepend="," property="planCode" >
        #planCode:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="editDate" >
        #editDate:TIMESTAMP#
      </isNotNull>
      <isNotNull prepend="," property="userId" >
        #userId:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="userName" >
        #userName:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="productBrand" >
        #productBrand:VARCHAR#
      </isNotNull>
	 <isNotNull prepend="," property="matStockOrderDetailId" >
        #matStockOrderDetailId:VARCHAR#
      </isNotNull>
      )
    </dynamic>
  </insert>
  <select id="ibatorgenerated_countByExample" parameterClass="com.tl.resource.dao.pojo.TReservePlanInforExample" resultClass="java.lang.Integer" >
    <!--
      WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
      This element was generated on Mon Nov 23 20:26:45 CST 2009.
    -->
    select count(*) from t_reserve_plan_infor
    <include refid="t_reserve_plan_infor.ibatorgenerated_Example_Where_Clause" />
  </select>
  <update id="ibatorgenerated_updateByExampleSelective" >
    <!--
      WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
      This element was generated on Mon Nov 23 20:26:45 CST 2009.
    -->
    update t_reserve_plan_infor
    <dynamic prepend="set" >
      <isNotNull prepend="," property="record.id" >
        id = #record.id:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="record.stockOrderDetailId" >
        stock_order_detail_id = #record.stockOrderDetailId:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="record.brandCode" >
        brand_code = #record.brandCode:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="record.productCode" >
        product_code = #record.productCode:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="record.toolsId" >
        tools_id = #record.toolsId:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="record.parentToolsId" >
        parent_tools_id = #record.parentToolsId:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="record.leaf" >
        leaf = #record.leaf:INTEGER#
      </isNotNull>
      <isNotNull prepend="," property="record.productName" >
        product_name = #record.productName:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="record.planAmount" >
        plan_amount = #record.planAmount:DECIMAL#
      </isNotNull>
      <isNotNull prepend="," property="record.productUnit" >
        product_unit = #record.productUnit:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="record.price" >
        price = #record.price:DECIMAL#
      </isNotNull>
      <isNotNull prepend="," property="record.productMoney" >
        product_money = #record.productMoney:DECIMAL#
      </isNotNull>
      <isNotNull prepend="," property="record.orderInforId" >
        order_infor_id = #record.orderInforId:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="record.orderCode" >
        order_code = #record.orderCode:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="record.contractId" >
        contract_id = #record.contractId:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="record.contractCode" >
        contract_code = #record.contractCode:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="record.status" >
        status = #record.status:INTEGER#
      </isNotNull>
      <isNotNull prepend="," property="record.planCode" >
        plan_code = #record.planCode:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="record.editDate" >
        edit_date = #record.editDate:TIMESTAMP#
      </isNotNull>
      <isNotNull prepend="," property="record.userId" >
        user_id = #record.userId:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="record.userName" >
        user_name = #record.userName:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="record.productBrand" >
        product_brand = #record.productBrand:VARCHAR#
      </isNotNull>
       <isNotNull prepend="," property="record.matStockOrderDetailId" >
        mat_stock_order_detail_id = #record.matStockOrderDetailId:VARCHAR#
      </isNotNull>
    </dynamic>
    <isParameterPresent >
      <include refid="t_reserve_plan_infor.ibatorgenerated_Example_Where_Clause" />
    </isParameterPresent>
  </update>
  <update id="ibatorgenerated_updateByExample" >
    <!--
      WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
      This element was generated on Mon Nov 23 20:26:45 CST 2009.
    -->
    update t_reserve_plan_infor
    set id = #record.id:VARCHAR#,
      stock_order_detail_id = #record.stockOrderDetailId:VARCHAR#,
      brand_code = #record.brandCode:VARCHAR#,
      product_code = #record.productCode:VARCHAR#,
      tools_id = #record.toolsId:VARCHAR#,
      parent_tools_id = #record.parentToolsId:VARCHAR#,
      leaf = #record.leaf:INTEGER#,
      product_name = #record.productName:VARCHAR#,
      plan_amount = #record.planAmount:DECIMAL#,
      product_unit = #record.productUnit:VARCHAR#,
      price = #record.price:DECIMAL#,
      product_money = #record.productMoney:DECIMAL#,
      order_infor_id = #record.orderInforId:VARCHAR#,
      order_code = #record.orderCode:VARCHAR#,
      contract_id = #record.contractId:VARCHAR#,
      contract_code = #record.contractCode:VARCHAR#,
      status = #record.status:INTEGER#,
      plan_code = #record.planCode:VARCHAR#,
      edit_date = #record.editDate:TIMESTAMP#,
      user_id = #record.userId:VARCHAR#,
      user_name = #record.userName:VARCHAR#,
      product_brand = #record.productBrand:VARCHAR#,
      mat_stock_order_detail_id = #record.matStockOrderDetailId:VARCHAR#
    <isParameterPresent >
      <include refid="t_reserve_plan_infor.ibatorgenerated_Example_Where_Clause" />
    </isParameterPresent>
  </update>
  <update id="ibatorgenerated_updateByPrimaryKeySelective" parameterClass="com.tl.resource.dao.pojo.TReservePlanInfor" >
    <!--
      WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
      This element was generated on Mon Nov 23 20:26:45 CST 2009.
    -->
    update t_reserve_plan_infor
    <dynamic prepend="set" >
      <isNotNull prepend="," property="stockOrderDetailId" >
        stock_order_detail_id = #stockOrderDetailId:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="brandCode" >
        brand_code = #brandCode:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="productCode" >
        product_code = #productCode:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="toolsId" >
        tools_id = #toolsId:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="parentToolsId" >
        parent_tools_id = #parentToolsId:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="leaf" >
        leaf = #leaf:INTEGER#
      </isNotNull>
      <isNotNull prepend="," property="productName" >
        product_name = #productName:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="planAmount" >
        plan_amount = #planAmount:DECIMAL#
      </isNotNull>
      <isNotNull prepend="," property="productUnit" >
        product_unit = #productUnit:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="price" >
        price = #price:DECIMAL#
      </isNotNull>
      <isNotNull prepend="," property="productMoney" >
        product_money = #productMoney:DECIMAL#
      </isNotNull>
      <isNotNull prepend="," property="orderInforId" >
        order_infor_id = #orderInforId:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="orderCode" >
        order_code = #orderCode:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="contractId" >
        contract_id = #contractId:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="contractCode" >
        contract_code = #contractCode:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="status" >
        status = #status:INTEGER#
      </isNotNull>
      <isNotNull prepend="," property="planCode" >
        plan_code = #planCode:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="editDate" >
        edit_date = #editDate:TIMESTAMP#
      </isNotNull>
      <isNotNull prepend="," property="userId" >
        user_id = #userId:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="userName" >
        user_name = #userName:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="productBrand" >
        product_brand = #productBrand:VARCHAR#
      </isNotNull>
	  <isNotNull prepend="," property="matStockOrderDetailId" >
        mat_stock_order_detail_id = #matStockOrderDetailId:VARCHAR#
      </isNotNull>
    </dynamic>
    where id = #id:VARCHAR#
  </update>
  <update id="ibatorgenerated_updateByPrimaryKey" parameterClass="com.tl.resource.dao.pojo.TReservePlanInfor" >
    <!--
      WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
      This element was generated on Mon Nov 23 20:26:45 CST 2009.
    -->
    update t_reserve_plan_infor
    set stock_order_detail_id = #stockOrderDetailId:VARCHAR#,
      brand_code = #brandCode:VARCHAR#,
      product_code = #productCode:VARCHAR#,
      tools_id = #toolsId:VARCHAR#,
      parent_tools_id = #parentToolsId:VARCHAR#,
      leaf = #leaf:INTEGER#,
      product_name = #productName:VARCHAR#,
      plan_amount = #planAmount:DECIMAL#,
      product_unit = #productUnit:VARCHAR#,
      price = #price:DECIMAL#,
      product_money = #productMoney:DECIMAL#,
      order_infor_id = #orderInforId:VARCHAR#,
      order_code = #orderCode:VARCHAR#,
      contract_id = #contractId:VARCHAR#,
      contract_code = #contractCode:VARCHAR#,
      status = #status:INTEGER#,
      plan_code = #planCode:VARCHAR#,
      edit_date = #editDate:TIMESTAMP#,
      user_id = #userId:VARCHAR#,
      user_name = #userName:VARCHAR#,
      product_brand = #productBrand:VARCHAR#,
      mat_stock_order_detail_id = #matStockOrderDetailId:VARCHAR#
    where id = #id:VARCHAR#
  </update>
  <select id="getReservePlanDetailChildren" parameterClass="java.lang.String" resultClass="java.util.List" resultMap="resultHasReserve">
  	select pl.id ,detail.id stock_order_detail_id,pl.order_infor_id,pl.order_code,pl.contract_id,pl.edit_date,pl.user_id,pl.user_name,pl.contract_code,
  	pl.status,pl.plan_code,
     detail.leaf,detail.contract_product_detail_id ,detail.stock_order_infor_id ,detail.brand_code ,detail.tools_id ,
		detail.parent_tools_id ,
		detail.serial_number,
		detail.project_code,
		detail.product_name ,detail.contract_amount,detail.order_amount,detail.product_unit, detail.price,
		detail.product_money, detail.product_code,     
		ifnull((select i.amount from t_reserve_infor i where i.product_code = detail.product_code),0) reserve_amount,
	   ifnull(pl.plan_amount,0) plan_amount,detail.product_brand,pl.mat_stock_order_detail_id
      from t_order_detail detail left join t_reserve_plan_infor pl      
		on pl.stock_order_detail_id = detail.id
		where detail.parent_tools_id=#value# 
  </select>
  <select id="getReservePlanDetail" parameterClass="java.lang.String" resultClass="java.util.List" resultMap="resultHasReserve">
  select pl.id,detail.id stock_order_detail_id,pl.order_infor_id,pl.order_code, detail.leaf,pl.contract_id,pl.edit_date,pl.user_id,pl.user_name,pl.contract_code,
  pl.status,pl.plan_code,
  detail.contract_product_detail_id ,detail.stock_order_infor_id ,detail.brand_code ,detail.tools_id ,
		detail.parent_tools_id ,
		detail.serial_number,
		detail.project_code,
		detail.product_name ,detail.contract_amount,detail.order_amount,detail.product_unit, detail.price,
		detail.product_money, detail.product_code,     
		ifnull((select i.amount from t_reserve_infor i where i.product_code = detail.product_code),0) reserve_amount,
	   ifnull(pl.plan_amount,0) plan_amount,detail.product_brand,pl.mat_stock_order_detail_id
      from t_order_detail detail left join t_reserve_plan_infor pl      
		on pl.stock_order_detail_id = detail.id
		where detail.parent_tools_id = 'root' and detail.stock_order_infor_id=#value#
  </select>
  
  <!-- 根据供应商ID得到储备计划列表 -->
  <select id="getPlanList" parameterClass="java.util.Map" resultClass="java.util.List" resultMap="resultMap">
  	select 
  	  r.id, r.stock_order_detail_id, r.brand_code, r.product_code, r.tools_id,
      r.parent_tools_id, r.leaf, r.product_name, r.plan_amount, r.product_unit, r.price, product_money,
      r.order_infor_id, r.order_code, r.contract_id, r.contract_code, r.status, r.plan_code, r.edit_date, r.user_id,
      r.user_name,r.product_brand,r.mat_stock_order_detail_id
  	from 
	t_reserve_plan_infor r,
	t_suppliers_brand b
	where 
	b.t_suppliers_id = '$supplierId$'
	and
	r.product_brand = b.brand
	and
	r.status = 2
	<isNotEmpty property="brandCode" prepend="and">
    	r.brand_code like '$brandCode$'
    </isNotEmpty>
    <isNotEmpty property="productName" prepend="and">
    	r.product_name like '$productName$'
    </isNotEmpty>
    <isNotEmpty property="sort" >
        <![CDATA[
          order by $sort$ $dir$
        ]]>
      </isNotEmpty>
      <isEmpty property="sort" >
        <![CDATA[
           order by r.edit_date DESC
        ]]>
      </isEmpty>
	<isNotEmpty property="startIndex">
       limit #startIndex#, #pageSize# 
    </isNotEmpty>
  </select>
  
  <select id="getPlanListCount" parameterClass="java.util.Map" resultClass="java.lang.Integer">
  	select count(*)
  	from 
	t_reserve_plan_infor r,
	t_suppliers_brand b
	where 
	b.t_suppliers_id = '$supplierId$'
	and
	r.product_brand = b.brand
	and
	r.status = 2
	<isNotEmpty property="brandCode" prepend="and">
    	r.brand_code like '$brandCode$'
    </isNotEmpty>
    <isNotEmpty property="productName" prepend="and">
    	r.product_name like '$productName$'
    </isNotEmpty>
  </select>
  
  
  <update id="updateReservePlanByOrderId" parameterClass="java.lang.String" >
    <!--
      WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
      This element was generated on Mon Nov 23 20:26:45 CST 2009.
    -->
    update t_reserve_plan_infor set status = 2 
	where mat_stock_order_detail_id in 
	(select d.id from t_order_detail d where stock_order_infor_id = #id:VARCHAR#)
  </update>
</sqlMap>